---
title: "moccasin"
format: html
author: "ABC"
date: "01/06/2025"
---

```{r}
#| label: necessary libraries
library(ggplot2)
library(tidyverse)
library(maps)
```

```{r}
#| label: data preprocessing

# Load the dataset
data <- read.csv("measles_cases.csv")

# Check for any duplicate rows
data <- distinct(data)

# Print the first few rows of the dataset
head(data)

# Drop the last column
data <- data[, 1:2]  # Keeps only "State" and "Confirmed Cases"

# Check for missing values
sum(is.na(data))  # Total number of NA values

head(data)
```

```{r data-visualization, fig.width=8, fig.height=4}

# Convert state names for merging
data$State <- tolower(data$State)

# Define case bins and numeric labels
breaks <- c(-1, 10, 50, 100, 500, Inf)
labels <- c("1–10", "11–50", "51–100", "101–500", ">500")
data$Severity <- cut(data$Confirmed.Cases, breaks = breaks, labels = labels)

# Load map and merge with data
states_map <- map_data("state")
choropleth_data <- left_join(states_map, data, by = c("region" = "State"))

# Prepare label positions and full abbreviations
label_data <- aggregate(cbind(long, lat) ~ region, data = choropleth_data, FUN = function(x) mean(range(x)))
label_data$Severity <- data$Severity[match(label_data$region, data$State)]
label_data$abbr <- state.abb[match(toupper(label_data$region), toupper(state.name))]

# Filter only states with 51+ cases (moderate or above)
label_data <- subset(label_data, Severity %in% c("51–100", ">500"))

# Use black text for all
label_data$label_color <- "black"

# Define color palette
fill_colors <- c("1–10" = "#fef0d9",
                 "11–50" = "#fdcc8a",
                 "51–100" = "#fc8d59",
                 "101–500" = "#e34a33",
                 ">500" = "#b30000")

# Plot
ggplot(choropleth_data, aes(x = long, y = lat, group = group, fill = Severity)) +
  geom_polygon(color = "white") +
  geom_path(color = "black", linewidth = 0.3) +
  geom_text(data = label_data,
            aes(x = long, y = lat, label = abbr),
            color = "black", fontface = "bold", size = 3, inherit.aes = FALSE) +
  scale_fill_manual(values = fill_colors, na.value = "grey90") +
  labs(title = "2025 Measles Severity by State",
       fill = "Confirmed Cases",
       caption = "Note: Only states with 51+ confirmed cases are labeled for clarity.") +
  theme_minimal() +
  theme(legend.background = element_rect(color = "black", fill = NA, size = 0.5),
        axis.text = element_blank(),
        axis.title = element_blank(),
        panel.grid = element_blank(),
        plot.caption = element_text(hjust = 0.5, size = 8, face = "italic"))
```